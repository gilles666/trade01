<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Top 20 des hausses crypto (24 h)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ---------- Styles simples & responsives ---------- */
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 1rem;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #lastUpdate {
      text-align: center;
      font-size: .85rem;
      color: #666;
      margin-bottom: .5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    th, td {
      padding: .6rem .8rem;
      text-align: left;
    }
    thead {
      background: #eaeff5;
    }
    tbody tr:nth-child(even) {background:#f5f8fd}
    .price, .change {text-align: right;}
    .change.positive {color:#0a8f08}
    .change.negative {color:#d00}
    .coin-img {
      width: 20px;
      height: 20px;
      vertical-align: middle;
      margin-right: .4rem;
      border-radius: 50%;
    }
    a {color:inherit; text-decoration:none;}
    a:hover {text-decoration:underline;}
    @media (max-width:600px) {
      table {font-size:.9rem;}
    }
  </style>
</head>
<body>
  <h1>Top 20 des hausses (24 h) v1</h1>
  <div id="lastUpdate"></div>
  <table id="cryptoTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Nom</th>
        <th class="price">Prix (USD)</th>
        <th class="change">Δ 24 h %</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // -------------------------------------------------
    // 1️⃣ Configuration
    // -------------------------------------------------
    const API_URL = 'https://api.coingecko.com/api/v3/coins/markets' +
                    '?vs_currency=usd' +
                    '&order=market_cap_desc' +
                    '&per_page=250' +          // enough to get the top 20 winners
                    '&page=1' +
                    '&price_change_percentage=24h';

    const REFRESH_MS = 5 * 60 * 1000;   // 5 minutes

    // -------------------------------------------------
    // 2️⃣ Fonction principale : récupérer & afficher
    // -------------------------------------------------
    async function loadTop20() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        // garder seulement les coins avec un pourcentage non nul
        const filtered = data.filter(c => c.price_change_percentage_24h !== null);

        // trier décroissant sur la hausse
        filtered.sort((a, b) =>
          b.price_change_percentage_24h - a.price_change_percentage_24h
        );

        // 20 premiers
        const top20 = filtered.slice(0, 20);

        // ------- Mettre à jour le tableau -------
        const tbody = document.querySelector('#cryptoTable tbody');
        tbody.innerHTML = '';   // reset

        top20.forEach((coin, idx) => {
          const tr = document.createElement('tr');

          // 1️⃣ Rang
          const tdRank = document.createElement('td');
          tdRank.textContent = idx + 1;
          tr.appendChild(tdRank);

          // 2️⃣ Nom + icône
          const tdName = document.createElement('td');
          const img = document.createElement('img');
          img.src = coin.image;
          img.alt = coin.name;
          img.className = 'coin-img';
          const a = document.createElement('a');
          a.href = `https://www.coingecko.com/en/coins/${coin.id}`;
          a.target = '_blank';
          a.rel = 'noopener';
          a.textContent = `${coin.name} (${coin.symbol.toUpperCase()})`;
          tdName.appendChild(img);
          tdName.appendChild(a);
          tr.appendChild(tdName);

          // 3️⃣ Prix
          const tdPrice = document.createElement('td');
          tdPrice.className = 'price';
          tdPrice.textContent = coin.current_price.toLocaleString(undefined, {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 2
          });
          tr.appendChild(tdPrice);

          // 4️⃣ Variation 24h
          const tdChange = document.createElement('td');
          tdChange.className = 'change';
          const change = coin.price_change_percentage_24h;
          tdChange.textContent = `${change.toFixed(2)}%`;
          tdChange.classList.add(change >= 0 ? 'positive' : 'negative');
          tr.appendChild(tdChange);

          tbody.appendChild(tr);
        });

        // ------- Date de mise à jour -------
        const now = new Date();
        document.getElementById('lastUpdate')
                .textContent = `Dernière mise à jour : ${now.toLocaleTimeString()}`;
      } catch (e) {
        console.error(e);
        document.getElementById('lastUpdate')
                .textContent = `Erreur lors du chargement des données (${e.message})`;
      }
    }

    // -------------------------------------------------
    // 3️⃣ Lancer le premier chargement & le rafraîchissement
    // -------------------------------------------------
    loadTop20();                               // au démarrage
    setInterval(loadTop20, REFRESH_MS);        // toutes les 5 min
  </script>
</body>
</html>
